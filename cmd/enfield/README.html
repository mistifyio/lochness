<!DOCTYPE html>
<html lang="en">
<head>
    <title>Enfield</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="media/css/restdown.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
</head>
<body>
<div id="header">
    <h1>Enfield Documentation</h1>
</div>

    <div id="sidebar">
<ul>
  <li><div><a href="#ipxe">ipxe</a></div>
  <ul>
    <li><div><a href="#GET-/ipxe/:ip"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/ipxe/:ip</span></span></span></a></div></li>
  </ul></li>
  <li><div><a href="#images">images</a></div>
  <ul>
    <li><div><a href="#GET-/images/:version/:file"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/images/:version/:file</span></span></span></a></div></li>
  </ul></li>
  <li><div><a href="#configs">configs</a></div>
  <ul>
    <li><div><a href="#GET-/configs/:ip"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/configs/:ip</span></span></span></a></div></li>
  </ul></li>
</ul>

    </div>
    <div id="content">

<h1>Enfield</h1>
<div class="intro">


<p>Enfield is a three legged, short bodied, short clawed armed grayish cryptid with
big reddish eyes (<a href="http://en.wikipedia.org/wiki/Enfield_Monster">Wikipedia</a>).</p>

<p>Also a simple web service to enable boot and pre-init configuration of LochNess
nodes.</p>

<p>Current service endpoints served by enfield are:</p>

<ul>
<li><code>/ipxe</code> - iPXE config</li>
<li><code>/images</code> - boot images (<em>kernel</em>, <em>rootfs</em>)</li>
<li><code>/configs</code> - pre-init node configuration (<em>zfs</em>, <em>etcd</em>, ...)</li>
</ul>


</div>
<h1 id="ipxe">ipxe</h1>

<h2 id="GET-/ipxe/:ip"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/ipxe/:ip</span></span></span></h2>

<p>Get an ipxe script that corresponds to this hv.</p>

<h4 id="request">request</h4>

<pre><code>curl http://192.168.100.100:8888/ipxe/192.168.100.200
</code></pre>

<h4 id="response">response</h4>

<pre><code>#!ipxe
kernel http://192.168.100.100:8888/images/0.1.0/vmlinuz uuid=ed5df266-1416-497b-ac96-da42a77c5410
initrd http://192.168.100.100:8888/images/0.1.0/initrd
boot
</code></pre>

<h1 id="images">images</h1>

<h2 id="GET-/images/:version/:file"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/images/:version/:file</span></span></span></h2>

<p>Get kernel/rootfs</p>

<h4 id="request-2">request</h4>

<pre><code>wget http://192.168.100.100:8888/images/0.1.0/vmlinuz
</code></pre>

<h4 id="response-2">response</h4>

<pre><code>wget ipxe.services.lochness.local:8888/images/0.1.0/vmlinuz
--2015-03-12 19:24:49--  http://ipxe.services.lochness.local:8888/images/0.1.0/vmlinuz
Resolving ipxe.services.lochness.local (ipxe.services.lochness.local)... 192.168.100.100
Connecting to ipxe.services.lochness.local (ipxe.services.lochness.local)|192.168.100.100|:8888... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5765360 (5.5M) [application/octet-stream]
Saving to: 'vmlinuz'

vmlinuz                        100%[=========================================================&gt;]   5.50M  --.-KB/s   in 0.01s

2015-03-12 19:24:49 (426 MB/s) - 'vmlinuz' saved [5765360/5765360]
</code></pre>

<h1 id="configs">configs</h1>

<h2 id="GET-/configs/:ip"><span class="method justendpoint"><span class="endpoint"><span class="verb">GET</span> <span class="path">/configs/:ip</span></span></span></h2>

<p>Get a shell style file of K=V pairs for pre-init configuration</p>

<h4 id="request-3">request</h4>

<pre><code>curl http://192.168.100.100:8888/configs/192.168.100.200
</code></pre>

<h4 id="response-3">response</h4>

<pre><code>ETCD_DISCOVERY=https://discovery.etcd.io/3e86b59982e49066c5d813af1c2e2579cbf573de
ZFS_POOL=raid0
</code></pre>

    </div> <!-- #content -->
<script type="text/javascript" charset="utf-8">
$(function() {
    var headerHeight = $("#header").height();

    var sections = $("#content h1[id], #content h2[id]");
    var sectionOffsets = [];
    var slack = 100;  // Give the section scroll some slack (in pixels).
    sections.each(function(elem) {
        sectionOffsets.push($(this).offset().top - headerHeight - slack);
    });

    var currSectionIdx = -1;
    function getSectionIdx(scrollDistance) {
        if (scrollDistance < sectionOffsets[0]) {
            return -1;
        } else {
            for (var id = sectionOffsets.length; id > 0; id--) {
                if (scrollDistance > sectionOffsets[id - 1]) {
                    return id - 1;
                    break;
                }
            }
        }
    }

    /** {{{ http://code.activestate.com/recipes/577787/ (r2) */
    _slugify_strip_re = /[^\w\s-]/g;
    _slugify_hyphenate_re = /[-\s]+/g;
    function slugify(s) {
      s = s.replace(_slugify_strip_re, '').trim().toLowerCase();
      s = s.replace(_slugify_hyphenate_re, '-');
      return s;
    }
    /** end of http://code.activestate.com/recipes/577787/ }}} */

    /* See <https://github.com/trentm/restdown/issues/11>. */
    function safechars(s) {
      return s.replace(_slugify_strip_re, '');
    }

    $("#content").scroll(function() {
        var scrollDistance = $("#content").scrollTop();
        var sectionIdx = getSectionIdx(scrollDistance);

        if (sectionIdx !== currSectionIdx) {
            $("#sidebar li>div").removeClass("current");
            currSectionIdx = sectionIdx;
            if (currSectionIdx >= 0) {
                var heading = $(sections[currSectionIdx]).text();
                var possibleAnchors = [
                    slugify(heading), // h1 or non-method h2
                    heading.replace(/ /g, '-'), // h2 method, just name or just endpoint
                    heading.slice(0, heading.lastIndexOf(' (')).trimRight().replace(/ /g, '-'), // h2 method, name and endpoint
                ];
                for (var i=0; i < possibleAnchors.length; i++) {
                    var anchor = safechars(possibleAnchors[i]);
                    try {
                        $("#sidebar a[href=#" + anchor + "]").parent().addClass("current");
                    } catch (e) {
                        /* Ignore error if no such element. */
                        console.log(e)
                    }
                }
            }
        }
    });
});
</script>

</body>
</html>
